# WildDuel 플러그인 상세 게임 흐름 (수정 버전)

## 1. 로비 (LOBBY)

* **상태 진입**: 플러그인이 활성화되거나 게임이 종료되면 `LOBBY` 상태가 됩니다.
* **월드**: 플레이어는 `wildduel_world` 라는 이름의 전용 로비 월드에 위치합니다. 이 월드는 플러그인에 의해 자동으로 생성되며, 별도의 구조물이 없는 빈 공간입니다.
* **월드 준비**:

  * `wildduel_game` 월드가 존재하지 않으면, 로비 상태에서 즉시 재생성 절차를 진행합니다.
  * 재생성 중에는 서버 화이트리스트를 활성화하고, 접속 중인 모든 플레이어를 강제로 퇴장시킵니다.

    > 메시지: `월드 재생성 중입니다. 잠시 기다려주세요.`
  * 월드 생성이 완료되면 화이트리스트를 해제하고, 접속이 가능합니다.
* **플레이어 상태**: 로비에 입장하는 모든 플레이어는 인벤토리가 비워지고, 체력/배고픔이 최대로 회복되며, 게임 모드가 `어드벤처`로 설정되어 맵을 변경할 수 없습니다.
* **주요 활동**:

  * **팀 선택**: 플레이어는 `/팀선택` 명령어로 GUI를 열어 원하는 팀에 합류합니다.
  * **게임 준비**: 관리자는 게임 시작 전 각종 설정을 확인하고 준비합니다.
* **사용 가능 명령어**:

  * **플레이어**: `/팀선택`, `/tpa`, `/tpacancel`, `/tparesponse`
  * **관리자 (`/wd ...`):**

    * `randomteam`: 모든 플레이어를 무작위 팀에 배정합니다.
    * `team`: GUI로 수동 팀을 관리합니다.
    * `setinventory`: 게임 시작 시 지급될 기본 아이템을 현재 인벤토리 상태로 저장하거나 GUI로 편집합니다.
    * `admin`: 게임 시간, 팀 선택 규칙 등 핵심 설정을 변경하는 GUI를 엽니다.

## 2. 카운트다운 (COUNTDOWN)

* **상태 진입**: 관리자가 `/wd start` 명령어를 실행하고, 최소 인원(2명) 조건이 충족되면 시작됩니다.
* **월드 재생성 여부 확인**:

  * 카운트다운 전에 `wildduel_game` 월드가 준비되어 있는지 확인합니다.
  * 준비되지 않았다면, 로비 상태에서 이미 재생성 절차를 거치기 때문에 카운트다운 중에 랙이 발생하지 않습니다.
* **진행**: 10초간의 카운트다운이 진행되며, 모든 플레이어의 화면 중앙에 "게임이 곧 시작됩니다..." 라는 문구와 함께 남은 시간이 표시됩니다.
* **상태 유지**: 이 상태에서는 다른 행동이 제한되며, 게임 시작을 대기합니다.

## 3. 파밍 (FARMING)

* **상태 진입**: 카운트다운이 0초가 되면 자동으로 진입합니다.
* **월드**: 이미 로비 단계에서 준비된 `wildduel_game` 월드로 모든 플레이어를 중앙으로 텔레포트합니다.
* **플레이어 변화**:

  * 게임 모드가 `서바이벌`로 변경됩니다.
  * 관리자가 `/wd setinventory`로 설정해둔 기본 아이템이 인벤토리에 지급됩니다.
* **게임 규칙**:

  * **PvP 비활성화**: 플레이어 간 전투가 불가능합니다.
  * **사망 시 아이템 보존**: `KeepInventory` 규칙이 활성화되어, 죽어도 아이템을 잃지 않습니다.
  * **주기적인 허기 회복**: 모든 플레이어에게 주기적으로 포만감(Saturation) 효과가 부여되어 배고픔이 줄어들지 않습니다.
* **시간**: 기본 15분(900초)의 파밍 시간이 주어지며, 화면 상단의 보스바(Boss Bar)에 남은 시간이 표시됩니다. 관리자는 `/wd st <초>` 명령어로 시간을 조절할 수 있습니다.

## 4. 전투 (BATTLE)

* **상태 진입**: 파밍 시간이 모두 종료되면 자동으로 진입합니다.
* **플레이어 변화**: 주기적으로 부여되던 포만감 효과가 중단됩니다.
* **게임 규칙 변경**:

  * **PvP 활성화**: 모든 플레이어 간의 전투가 허용됩니다.
  * **사망 시 아이템 드롭**: `KeepInventory` 규칙이 비활성화되어, 죽으면 모든 아이템을 그 자리에 떨어뜨립니다.
  * **월드 보더 축소**: 월드 경계(World Border)가 10분에 걸쳐 100x100 크기로 점차 줄어들어, 플레이어들의 교전을 유도합니다.
* **진행**: 플레이어는 전투에서 패배하여 죽으면 `관전 모드`로 전환됩니다. 최후의 한 팀이 남을 때까지 전투는 계속됩니다.

## 5. 종료 (ENDED)

* **상태 진입**: 한 팀을 제외한 모든 팀의 플레이어가 전멸하면 자동으로 진입합니다.
* **결과 발표**: "게임 종료" 및 최종 승리 팀을 알리는 메시지가 모든 플레이어의 화면 중앙에 표시됩니다.
* **로비 귀환**: 10초 후, 모든 플레이어는 로비 월드(`wildduel_world`)로 다시 텔레포트됩니다.
* **월드 재생성**: 게임이 종료되면 즉시 `wildduel_game` 월드 재생성 절차를 실행하여, 다음 게임을 위한 준비를 마칩니다.
* **초기화**: 로비로 귀환한 후, 게임의 모든 데이터(팀, 월드 등)가 초기화되며 `LOBBY` 상태로 돌아가 다음 게임을 준비합니다.

버그 수정사항
개인전일때 게임 종료안됨
