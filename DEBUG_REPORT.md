# Wild_Duel 플러그인 디버깅 리포트 (with 젬민이❤️)

## 0. 치명적: 동기적 월드 생성으로 인한 서버 랙 (TPS 저하)

**문제점:**
- **동기적 월드 생성/삭제:** 현재 월드를 생성하고 삭제하는 작업이 서버의 메인 스레드에서 동기적으로 처리될 가능성이 높습니다. 이는 파일 I/O 작업으로 인해 메인 스레드를 몇 초간 완전히 멈추게 하여, 서버 전체의 심각한 랙(TPS 급락)을 유발합니다. 이 현상은 특히 파일 시스템이 다른 리눅스(우분투) 환경에서 더욱 두드러집니다.

**수정 제안:**
- **비동기 처리 도입:** 월드 생성 및 삭제 로직을 `Bukkit.getScheduler().runTaskAsynchronously()` 등을 사용하여 비동기적으로 처리해야 합니다.
  1.  **(동기)** `Bukkit.unloadWorld()`로 월드를 언로드합니다.
  2.  **(비동기)** 월드 폴더를 삭제하는 파일 I/O 작업을 비동기 스레드에서 실행합니다.
  3.  **(동기/비동기 혼합)** 월드 생성(`Bukkit.createWorld()`)은 동기적으로 호출하되, 청크 로딩(`world.getChunkAt().load()`)과 같은 무거운 작업은 비동기 스레드에서 처리하여 서버 부하를 최소화해야 합니다.

## 1. 심각: 동시성 문제 (Thread Safety)

**문제점:**
- **`GameManager`의 게임 상태 관리:** `gameState` 변수가 여러 스레드에서 동기화 없이 접근/수정되고 있어, 동시 접근 시 상태 불일치나 오류를 유발할 수 있습니다.
- **`TeamManager`의 플레이어 데이터:** 팀 소속 플레이어 목록(`HashSet`)이 스레드에 안전하지 않아, 동시적인 플레이어 참가/이탈 시 `ConcurrentModificationException` 발생 또는 데이터 손상 위험이 있습니다.

**수정 제안:**
- `GameManager`의 상태 변경 메소드(`startGame`, `endGame` 등)에 `synchronized` 키워드를 추가하여 스레드 동기화를 보장해야 합니다.
- `TeamManager`의 `players` Set을 `Collections.synchronizedSet`으로 감싸거나 `CopyOnWriteArraySet`으로 교체하여 스레드 안전성을 확보해야 합니다.

## 2. 높음: `NullPointerException` (NPE) 발생 가능성

**문제점:**
- **`GameManager.startGame()`:** 팀 스폰 위치가 설정되지 않은 상태에서 게임을 시작하면 `teamManager.getTeamSpawn()`이 `null`을 반환하여 `player.teleport(null)` 실행으로 인한 `NullPointerException`이 발생합니다.

**수정 제안:**
- `startGame` 메소드에서 게임 시작 전 모든 팀의 스폰 위치 설정 여부를 검사하고, 미설정 시 게임 시작을 중단하고 관리자에게 경고 메시지를 보내는 로직을 추가해야 합니다.

## 3. 보통: 게임 로직 및 자원 관리 문제

**문제점:**
- **게임 종료 후 스폰 위치:** 게임 종료 시 플레이어를 월드의 기본 스폰 지점으로 이동시켜, 의도된 로비나 대기실로 보내지 못하는 문제가 있습니다.
- **`onDisable`에서의 작업 미처리:** 플러그인 비활성화 시 `BukkitTask` (게임 타이머 등)가 취소되지 않아 메모리 누수 및 원치 않는 작업 실행의 원인이 됩니다.
- **인벤토리 공간 부족:** `onPlayerJoin` 이벤트에서 플레이어 인벤토리가 가득 찼는지 확인하지 않고 아이템을 지급하여 아이템이 유실될 수 있습니다.

**수정 제안:**
- `config.yml`에 로비 위치 설정 옵션을 추가하고, 게임 종료 시 해당 위치로 이동시키도록 수정해야 합니다.
- `onDisable` 메소드에 `gameManager.endGame(null)` 호출 또는 `BukkitTask` 취소 로직을 추가하여 자원을 정리해야 합니다.
- 아이템 지급 전 인벤토리 공간을 확인하고, 부족할 경우 경고 메시지를 보내는 로직을 추가해야 합니다.

## 4. 낮음: 사용자 경험 및 편의성

**문제점:**
- **피드백 부족:** `/wd setspawn` 등 관리자 명령어 실행 시 성공 여부를 알려주는 피드백이 없습니다.
- **불분명한 오류 메시지:** 게임 시작 조건 미충족 시 "게임 시작에 실패했습니다"와 같이 원인을 알 수 없는 메시지만 표시됩니다.

**수정 제안:**
- 주요 명령어 실행 후 성공 여부나 결과에 대한 명확한 피드백 메시지를 추가해야 합니다.
- 게임 시작 실패 시 "플레이어 수가 부족합니다" 또는 "레드 팀 스폰이 설정되지 않았습니다"와 같이 구체적인 원인을 관리자에게 전달하도록 수정해야 합니다.